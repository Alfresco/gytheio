<?xml version='1.0' encoding='UTF-8'?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:context="http://www.springframework.org/schema/context"
    xsi:schemaLocation="
          http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
          http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd">

    <bean id="messagingObjectMapper" class="org.gytheio.messaging.jackson.ObjectMapperFactory" 
        factory-method="createInstance" />

    <bean id="activeMqConnectionFactory" class="org.apache.activemq.ActiveMQConnectionFactory">
        <property name="brokerURL" value="${messaging.broker.url}" />
    </bean>

    <bean id="camelAmqpComponent" class="org.apache.camel.component.amqp.AMQPComponent">
        <property name="connectionFactory" ref="activeMqConnectionFactory" />
    </bean>
    
    <camelContext id="camelContext" xmlns="http://camel.apache.org/schema/spring">
        <!-- Any RouteBuilder in this package will be fired up -->
        <package>org.alfresco.messaging.camel.routes</package>
        
        <template id="camelProducerTemplate"
            defaultEndpoint="direct:alfresco.default" />
    </camelContext>
    
    <import resource="camelRoutes.xml" />
    <bean id="defaultRouteLoader" class="org.alfresco.messaging.camel.RouteLoader">
        <property name="camelContextId" value="camelContext" />
        <property name="routeContextId" value="deadLetterRoutes" />
    </bean>
    
    <!-- In the default routes, this is where a message goes if no queue is specified -->
    <bean id="deadLetterQueue" class="org.gytheio.messaging.LoggingDeadLetterQueue" />

</beans>
